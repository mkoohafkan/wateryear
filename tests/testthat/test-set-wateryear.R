test_that("set water year", {

  expect_error(set_wateryear(start = "2021-05-01"))
  expect_error(set_wateryear(end = "2021-04-30"))
  expect_error(set_wateryear("foo", "bar"))
  expect_error(set_wateryear("2021-04-31", "2021-04-30"))
  expect_error(set_wateryear(NA, "2021-04-30"))
  expect_error(set_wateryear(NULL, "2021-04-30"))
  expect_error(set_wateryear("2003-10-01", "2004-10-01"))
  expect_error(set_wateryear("2003-10-01", "2004-09-29"))
  expect_error(set_wateryear("10-01", "09-30", "%m-%d"))
  expect_error(set_wateryear("10-01", "09-29"))
  expect_error(set_wateryear("2001-01-01", "2000-12-31"))

  s1 = as.Date("2004-01-01")
  e1 = as.Date("2004-12-31")
  expect_true(set_wateryear(s1, e1, verbose = FALSE))
  expect_identical(.wateryear$start(), s1)
  expect_identical(.wateryear$end(), e1)
  s2 = as.Date("2001-01-01")
  e2 = as.Date("2001-12-31")
  expect_warning(expect_true(set_wateryear(s2, e2, verbose = FALSE)))
  expect_identical(.wateryear$start(), s2)
  expect_identical(.wateryear$end(), e2)
  s3 = as.Date("2003-10-01")
  e3 = as.Date("2004-09-30")
  expect_message(expect_true(set_wateryear(s3, e3)),
    "Water year set to: 10-01 - 09-30\nReference year set to: 2004")
  expect_true(set_wateryear(s3, e3, verbose = FALSE))
  expect_identical(.wateryear$start(), s3)
  expect_identical(.wateryear$end(), e3)

  .wateryear$reset()
  expect_identical(.wateryear$start(), NULL)
  expect_identical(.wateryear$end(), NULL)

})
